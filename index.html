<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
    span.s2 {font: 12.0px 'Apple Color Emoji'; font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="pt-BR"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;Giro - Controle de Fluxo de Caixa&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/chart.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.modal {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: none; /* Hidden by default */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>position: fixed; /* Stay in place */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>z-index: 50; /* Sit on top */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>left: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>top: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 100%; /* Full width */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 100%; /* Full height */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>overflow: auto; /* Enable scroll if needed */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background-color: rgba(0,0,0,0.5); /* Black w/ opacity */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body class="bg-gray-100 text-gray-800"&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Login Container --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="login-container" class="fixed inset-0 bg-gray-900 flex items-center justify-center z-50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h2 class="text-2xl font-bold text-center text-gray-800 mb-6"&gt;Giro - Acesso Restrito&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="login-error" class="text-red-500 text-sm mb-4 text-center hidden"&gt;Login ou senha inválidos.&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;form id="login-form"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label for="username" class="block text-sm font-medium text-gray-700 mb-1"&gt;Login&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="mb-6"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label for="password" class="block text-sm font-medium text-gray-700 mb-1"&gt;Senha&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Entrar</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/form&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- App Container --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="app-container" class="hidden p-4 md:p-8 max-w-7xl mx-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;header class="mb-8 flex flex-col sm:flex-row justify-between sm:items-center gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h1 class="text-4xl font-bold text-gray-900"&gt;Controle de Fluxo de Caixa&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-gray-600 mt-1"&gt;Gerencie as transações e saldos entre suas empresas.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button id="reset-all-btn" class="bg-red-600 text-white px-3 py-1 text-sm rounded-md hover:bg-red-700 transition self-start sm:self-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>ZERAR PAGAMENTOS</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/header&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="grid grid-cols-1 lg:grid-cols-3 gap-8"&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Coluna da Esquerda: Cadastros e Lançamentos --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="lg:col-span-1 space-y-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Cadastro de Empresas --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="bg-white p-6 rounded-lg shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-xl font-semibold mb-4 border-b pb-2"&gt;1. Cadastrar Empresas&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;input type="text" id="company-name" placeholder="Nome da empresa" class="flex-grow w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="add-company-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition"&gt;Adicionar&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;ul id="company-list" class="mt-4 space-y-2 text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- Empresas serão listadas aqui --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/ul&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Controle de Aportes --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="bg-white p-6 rounded-lg shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-xl font-semibold mb-4 border-b pb-2"&gt;2. Registrar/Editar Aporte&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-sm text-gray-600 mb-4"&gt;Defina o valor total que cada empresa irá movimentar. O valor é salvo automaticamente ao sair do campo.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="contributions-container" class="space-y-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;!-- Formulários de aporte por empresa serão gerados aqui --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Lançamento de Transação --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="bg-white p-6 rounded-lg shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-xl font-semibold mb-4 border-b pb-2"&gt;3. Lançar Transação&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;De (Pagador)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="payer-select" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Para (Recebedor)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="receiver-select" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Valor (R$)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="number" id="transaction-amount" placeholder="Ex: 1500.50" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Nº da Nota Fiscal&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="text" id="invoice-number" placeholder="Nº da NF" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;div class="flex justify-between items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Descrição&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;button id="generate-description-btn" type="button" class="text-xs text-indigo-600 hover:text-indigo-800 font-semibold flex items-center gap-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span></span><span class="s2">✨</span><span class="s1"> Gerar com IA</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="text" id="transaction-description" placeholder="Breve descrição do pagamento" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="add-transaction-btn" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700 transition"&gt;Registrar Pagamento&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Coluna da Direita: Saldos e Histórico --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="lg:col-span-2 space-y-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Saldo Consolidado --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="bg-white p-6 rounded-lg shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-xl font-semibold mb-4 border-b pb-2"&gt;Saldo Consolidado em Caixa&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div id="consolidated-balance" class="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>&lt;!-- Saldos serão exibidos aqui --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div class="mt-6"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button id="analyze-flow-btn" class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 transition flex items-center justify-center gap-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s2">✨</span><span class="s1"> Analisar Fluxo de Caixa com IA</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Gráfico de Alocação de Capital --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="bg-white p-6 rounded-lg shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-xl font-semibold mb-4 border-b pb-2"&gt;Gráfico de Alocação de Capital&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-sm text-gray-600 mb-4"&gt;O gráfico mostra o capital original de cada empresa e onde ele está alocado atualmente.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="relative h-96"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>&lt;canvas id="allocationChartCanvas"&gt;&lt;/canvas&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Histórico de Transações --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="bg-white p-6 rounded-lg shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;h2 class="text-xl font-semibold mb-4 border-b pb-2"&gt;Histórico de Transações&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Filtros --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Filtrar por Pagador&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="filter-payer" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value=""&gt;Todas&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Filtrar por Recebedor&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="filter-receiver" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value=""&gt;Todas&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex items-end"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button id="clear-filters-btn" class="w-full bg-gray-500 text-white py-2 rounded-md hover:bg-gray-600 transition"&gt;Limpar Filtros&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="overflow-x-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;table class="min-w-full divide-y divide-gray-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;thead class="bg-gray-50"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"&gt;De&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"&gt;Para&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"&gt;Valor&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"&gt;NF&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"&gt;Descrição&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"&gt;Ações&lt;/th&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/thead&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;tbody id="transaction-history" class="bg-white divide-y divide-gray-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;!-- Histórico será inserido aqui --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/tbody&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/table&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Modal de Confirmação de Exclusão --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="confirmation-modal" class="modal"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h3 class="text-lg font-medium leading-6 text-gray-900" id="modal-title"&gt;Confirmar Exclusão&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm text-gray-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Você tem certeza que deseja excluir esta transação? Esta ação não pode ser desfeita.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="confirm-delete-btn" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:col-start-2 sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Excluir</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="cancel-delete-btn" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:col-start-1 sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Cancelar</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Modal de Edição de Transação --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="edit-transaction-modal" class="modal"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h3 class="text-lg font-medium leading-6 text-gray-900 mb-4"&gt;Editar Transação&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;form id="edit-transaction-form" class="space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;input type="hidden" id="edit-transaction-id"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;De (Pagador)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;select id="edit-payer-select" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Para (Recebedor)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;select id="edit-receiver-select" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Valor (R$)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="number" id="edit-transaction-amount" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Nº da Nota Fiscal&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="text" id="edit-invoice-number" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;Descrição&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="text" id="edit-transaction-description" class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/form&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="save-edit-btn" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none sm:col-start-2 sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Salvar Alterações</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="cancel-edit-btn" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:col-start-1 sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Cancelar</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Modal de Análise com IA --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="ai-analysis-modal" class="modal"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[80vh] flex flex-col"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex justify-between items-center mb-4 border-b pb-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h3 class="text-lg font-medium leading-6 text-gray-900"&gt;</span><span class="s2">✨</span><span class="s1"> Análise do Fluxo de Caixa&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="close-ai-modal-btn" class="text-gray-400 hover:text-gray-600"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="ai-analysis-content" class="text-sm text-gray-700 whitespace-pre-wrap overflow-y-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Conteúdo da análise será inserido aqui --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Modal de Confirmação de Reset Total --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="reset-confirmation-modal" class="modal"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h3 class="text-lg font-medium leading-6 text-gray-900"&gt;</span><span class="s2">⚠️</span><span class="s1"> ATENÇÃO! Ação Irreversível&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm text-gray-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Você tem certeza que deseja apagar TUDO? Isso inclui todas as empresas, aportes e transações. &lt;strong&gt;Esta ação não pode ser desfeita.&lt;/strong&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="confirm-reset-btn" type="button" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none sm:col-start-2 sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Sim, Zerar Tudo</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button id="cancel-reset-btn" type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:col-start-1 sm:text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>Cancelar</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Firebase SDK --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script type="module"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Importa as funções necessárias do SDK do Firebase</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, setDoc, getDoc, updateDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Configuração do Firebase da sua aplicação web</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const firebaseConfig = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>apiKey: "AIzaSyBcJmJfNlmx6-DpnQxTRtIP8icbxZYfD7Y",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>authDomain: "aplicativo-de-pagamento-giro.firebaseapp.com",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>projectId: "aplicativo-de-pagamento-giro",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>storageBucket: "aplicativo-de-pagamento-giro.appspot.com",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messagingSenderId: "704183756257",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>appId: "1:704183756257:web:f911997f19f559d644dea0",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>measurementId: "G-D38DS4EY9V"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Inicializa o Firebase</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const app = initializeApp(firebaseConfig);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const db = getFirestore(app);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Estado da Aplicação ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let companies = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let transactions = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let contributions = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let transactionToDeleteId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let transactionToEditId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let allocationChart = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Elementos do DOM ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const loginContainer = document.getElementById('login-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const appContainer = document.getElementById('app-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const loginForm = document.getElementById('login-form');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const loginError = document.getElementById('login-error');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const companyNameInput = document.getElementById('company-name');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const addCompanyBtn = document.getElementById('add-company-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const companyList = document.getElementById('company-list');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const payerSelect = document.getElementById('payer-select');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const receiverSelect = document.getElementById('receiver-select');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const transactionAmountInput = document.getElementById('transaction-amount');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const invoiceNumberInput = document.getElementById('invoice-number');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const transactionDescriptionInput = document.getElementById('transaction-description');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const addTransactionBtn = document.getElementById('add-transaction-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const consolidatedBalance = document.getElementById('consolidated-balance');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const transactionHistory = document.getElementById('transaction-history');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const contributionsContainer = document.getElementById('contributions-container');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const filterPayer = document.getElementById('filter-payer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const filterReceiver = document.getElementById('filter-receiver');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const clearFiltersBtn = document.getElementById('clear-filters-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const generateDescriptionBtn = document.getElementById('generate-description-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const analyzeFlowBtn = document.getElementById('analyze-flow-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const resetAllBtn = document.getElementById('reset-all-btn');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Modal de Exclusão</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const modal = document.getElementById('confirmation-modal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const confirmDeleteBtn = document.getElementById('confirm-delete-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const cancelDeleteBtn = document.getElementById('cancel-delete-btn');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Modal de Edição</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const editModal = document.getElementById('edit-transaction-modal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const editPayerSelect = document.getElementById('edit-payer-select');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const editReceiverSelect = document.getElementById('edit-receiver-select');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const editTransactionAmountInput = document.getElementById('edit-transaction-amount');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const editInvoiceNumberInput = document.getElementById('edit-invoice-number');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const editTransactionDescriptionInput = document.getElementById('edit-transaction-description');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const saveEditBtn = document.getElementById('save-edit-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const cancelEditBtn = document.getElementById('cancel-edit-btn');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Modal de Análise IA</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const aiAnalysisModal = document.getElementById('ai-analysis-modal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const aiAnalysisContent = document.getElementById('ai-analysis-content');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const closeAiModalBtn = document.getElementById('close-ai-modal-btn');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Modal de Reset</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const resetModal = document.getElementById('reset-confirmation-modal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const confirmResetBtn = document.getElementById('confirm-reset-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const cancelResetBtn = document.getElementById('cancel-reset-btn');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Funções de Formatação ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const formatCurrency = (value) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return new Intl.NumberFormat('pt-BR', {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>style: 'currency',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>currency: 'BRL',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}).format(value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Lógica de Login ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loginForm.addEventListener('submit', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>e.preventDefault();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const username = document.getElementById('username').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const password = document.getElementById('password').value;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (username === 'Luan' &amp;&amp; password === 'Giro123') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loginContainer.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>appContainer.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>initializeAppLogic();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>loginError.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Lógica Principal da Aplicação ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function initializeAppLogic() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Listeners do Firebase (tempo real)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(collection(db, 'companies'), (snapshot) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>companies = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() })).sort((a, b) =&gt; a.name.localeCompare(b.name));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(collection(db, 'transactions'), (snapshot) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>transactions = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>onSnapshot(collection(db, 'contributions'), (snapshot) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>contributions = snapshot.docs.map(doc =&gt; ({ id: doc.id, ...doc.data() }));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>renderAll();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Funções de Renderização e Cálculo ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function renderAll() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const balances = calculateBalances();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderCompanyList();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderSelectOptions();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderContributions();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderConsolidatedBalance(balances);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderTransactionHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderAllocationChart(balances);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function calculateBalances() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const balances = {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>companies.forEach(c =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>balances[c.name] = { total: 0, from: {} };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>contributions.forEach(contrib =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (balances[contrib.companyName]) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>balances[contrib.companyName].total += contrib.amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const fromMap = balances[contrib.companyName].from;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>fromMap[contrib.companyName] = (fromMap[contrib.companyName] || 0) + contrib.amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const sortedTransactions = [...transactions].sort((a, b) =&gt; (a.timestamp?.toDate() || 0) - (b.timestamp?.toDate() || 0));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sortedTransactions.forEach(t =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const payerName = t.payer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const receiverName = t.receiver;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const amount = t.amount;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (!balances[payerName] || !balances[receiverName]) return;<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const payerBalance = balances[payerName];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const receiverBalance = balances[receiverName];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const payerTotalFrom = Object.values(payerBalance.from).reduce((sum, val) =&gt; sum + val, 0);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (payerTotalFrom &lt;= 0) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const transferBreakdown = {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>for (const [originCompany, originAmount] of Object.entries(payerBalance.from)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (originAmount &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const proportion = originAmount / payerTotalFrom;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const transferAmountFromOrigin = amount * proportion;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>transferBreakdown[originCompany] = (transferBreakdown[originCompany] || 0) + transferAmountFromOrigin;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>for (const [originCompany, transferAmount] of Object.entries(transferBreakdown)) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>payerBalance.from[originCompany] = (payerBalance.from[originCompany] || 0) - transferAmount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>receiverBalance.from[originCompany] = (receiverBalance.from[originCompany] || 0) + transferAmount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>payerBalance.total -= amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>receiverBalance.total += amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return balances;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function renderCompanyList() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>companyList.innerHTML = companies.length &gt; 0<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>? companies.map(c =&gt; `&lt;li class="bg-gray-100 p-2 rounded"&gt;${c.name}&lt;/li&gt;`).join('')</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>: '&lt;li class="text-gray-500"&gt;Nenhuma empresa cadastrada.&lt;/li&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function renderSelectOptions() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const optionsHTML = companies.map(c =&gt; `&lt;option value="${c.name}"&gt;${c.name}&lt;/option&gt;`).join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>payerSelect.innerHTML = optionsHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>receiverSelect.innerHTML = optionsHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>editPayerSelect.innerHTML = optionsHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>editReceiverSelect.innerHTML = optionsHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>filterPayer.innerHTML = '&lt;option value=""&gt;Todas&lt;/option&gt;' + optionsHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>filterReceiver.innerHTML = '&lt;option value=""&gt;Todas&lt;/option&gt;' + optionsHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function renderContributions() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>contributionsContainer.innerHTML = companies.map(company =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const contribution = contributions.find(c =&gt; c.companyName === company.name);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const value = contribution ? contribution.amount : '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-sm font-medium text-gray-700"&gt;${company.name}&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-center gap-2 mt-1 relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;span class="text-gray-500 absolute left-3 z-10"&gt;R$&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;input type="number" data-company="${company.name}" value="${value}" placeholder="Valor do aporte" class="contribution-input pl-10 flex-grow w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}).join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function renderConsolidatedBalance(balances) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>consolidatedBalance.innerHTML = Object.entries(balances).map(([name, data]) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const detailsId = `details-${name.replace(/\s+/g, '-')}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const detailsHTML = Object.entries(data.from)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>.filter(([_, value]) =&gt; Math.abs(value) &gt; 0.001)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>.map(([fromCompany, value]) =&gt; `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;li class="flex justify-between text-gray-600"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span&gt;Origem: ${fromCompany}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="${value &gt;= 0 ? 'text-green-600' : 'text-red-600'}"&gt;${formatCurrency(value)}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/li&gt;`)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>.join('');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="bg-gray-50 p-4 rounded-lg border"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex justify-between items-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="font-semibold text-lg"&gt;${name}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;span class="font-bold text-2xl ${data.total &gt;= 0 ? 'text-green-700' : 'text-red-700'}"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>${formatCurrency(data.total)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>${detailsHTML ? `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="mt-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>&lt;button class="text-indigo-600 text-sm hover:underline" onclick="document.getElementById('${detailsId}').classList.toggle('hidden')"&gt;Ver Detalhes&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>&lt;ul id="${detailsId}" class="mt-2 space-y-1 text-sm hidden border-t pt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>${detailsHTML}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>&lt;/ul&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>` : ''}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}).join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function renderTransactionHistory() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const payerFilter = filterPayer.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const receiverFilter = filterReceiver.value;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const filteredTransactions = transactions.filter(t =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const payerMatch = !payerFilter || t.payer === payerFilter;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const receiverMatch = !receiverFilter || t.receiver === receiverFilter;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return payerMatch &amp;&amp; receiverMatch;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}).sort((a, b) =&gt; (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transactionHistory.innerHTML = filteredTransactions.map(t =&gt; `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;tr class="text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="px-4 py-3"&gt;${t.payer}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="px-4 py-3"&gt;${t.receiver}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="px-4 py-3 font-medium text-gray-900"&gt;${formatCurrency(t.amount)}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="px-4 py-3 text-gray-500"&gt;${t.invoice}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="px-4 py-3 text-gray-500 truncate" title="${t.description || ''}"&gt;${(t.description || '').substring(0,20)}${(t.description || '').length &gt; 20 ? '...' : ''}&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;td class="px-4 py-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button data-id="${t.id}" class="edit-transaction-btn text-indigo-600 hover:text-indigo-800" title="Editar"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /&gt;&lt;path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button data-id="${t.id}" class="delete-transaction-btn text-red-600 hover:text-red-800" title="Excluir"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"&gt;&lt;path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/td&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/tr&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`).join('');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function getChartColors(numColors) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const colors = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>'#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#6366F1', '#3B82F6',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>'#8B5CF6', '#EC4899', '#F97316', '#14B8A6', '#D946EF', '#06B6D4'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Repete o padrão de cores se precisar de mais do que o disponível</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return Array.from({ length: numColors }, (_, i) =&gt; colors[i % colors.length]);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function renderAllocationChart(balances) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const ctx = document.getElementById('allocationChartCanvas').getContext('2d');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (allocationChart) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>allocationChart.destroy();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const contributingCompanies = contributions.filter(c =&gt; c.amount &gt; 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (contributingCompanies.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>if (ctx) ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const labels = contributingCompanies.map(c =&gt; c.companyName);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const locationCompanies = [...new Set(companies.map(c =&gt; c.name))];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const colors = getChartColors(locationCompanies.length);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const locationColorMap = new Map(locationCompanies.map((loc, i) =&gt; [loc, colors[i]]));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const datasets = locationCompanies.map(location =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const data = labels.map(origin =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>return balances[location]?.from?.[origin] || 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>label: `Alocado em ${location}`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>data: data,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>backgroundColor: locationColorMap.get(location),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>allocationChart = new Chart(ctx, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>type: 'bar',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>data: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>labels: labels,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>datasets: datasets</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>options: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>responsive: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>maintainAspectRatio: false,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>plugins: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>title: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>display: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>text: 'Distribuição do Capital Aportado'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>tooltip: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>callbacks: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>label: function(context) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>let label = context.dataset.label || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>if (label) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                        </span>label += ': ';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>if (context.parsed.y !== null) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                        </span>label += formatCurrency(context.parsed.y);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>return label;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>scales: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>x: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>stacked: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>title: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>display: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>text: 'Capital Original (Aporte)'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>y: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>stacked: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>title: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>display: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>text: 'Valor Alocado (R$)'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>ticks: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>callback: function(value) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>return formatCurrency(value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Manipuladores de Eventos ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addCompanyBtn.addEventListener('click', async () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const name = companyNameInput.value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (name &amp;&amp; !companies.some(c =&gt; c.name.toLowerCase() === name.toLowerCase())) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>await addDoc(collection(db, 'companies'), { name });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>companyNameInput.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else if (!name) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>alert("O nome da empresa não pode estar vazio.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>alert("Essa empresa já foi cadastrada.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addTransactionBtn.addEventListener('click', async () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const payer = payerSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const receiver = receiverSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const amount = parseFloat(transactionAmountInput.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const invoice = invoiceNumberInput.value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const description = transactionDescriptionInput.value.trim();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!payer || !receiver || !amount || !invoice) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>alert('Preencha todos os campos obrigatórios (Pagador, Recebedor, Valor, NF).');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (payer === receiver) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>alert('A empresa pagadora e a recebedora não podem ser a mesma.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>await addDoc(collection(db, 'transactions'), {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>payer, receiver, amount, invoice, description, timestamp: new Date()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transactionAmountInput.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>invoiceNumberInput.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transactionDescriptionInput.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>contributionsContainer.addEventListener('change', async (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (e.target.classList.contains('contribution-input')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const companyName = e.target.dataset.company;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const amount = parseFloat(e.target.value) || 0;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const existingContribution = contributions.find(c =&gt; c.companyName === companyName);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (existingContribution) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>await updateDoc(doc(db, 'contributions', existingContribution.id), { amount });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>await addDoc(collection(db, 'contributions'), { companyName, amount });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>filterPayer.addEventListener('change', renderTransactionHistory);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>filterReceiver.addEventListener('change', renderTransactionHistory);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>clearFiltersBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>filterPayer.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>filterReceiver.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>renderTransactionHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.body.addEventListener('click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const deleteButton = e.target.closest('.delete-transaction-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (deleteButton) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>transactionToDeleteId = deleteButton.dataset.id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>modal.style.display = 'flex';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const editButton = e.target.closest('.edit-transaction-btn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (editButton) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>transactionToEditId = editButton.dataset.id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const transaction = transactions.find(t =&gt; t.id === transactionToEditId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (transaction) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>editPayerSelect.value = transaction.payer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>editReceiverSelect.value = transaction.receiver;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>editTransactionAmountInput.value = transaction.amount;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>editInvoiceNumberInput.value = transaction.invoice;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>editTransactionDescriptionInput.value = transaction.description;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>editModal.style.display = 'flex';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>cancelDeleteBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transactionToDeleteId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>modal.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>confirmDeleteBtn.addEventListener('click', async () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (transactionToDeleteId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>await deleteDoc(doc(db, "transactions", transactionToDeleteId));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>transactionToDeleteId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>modal.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>cancelEditBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transactionToEditId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>editModal.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveEditBtn.addEventListener('click', async () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!transactionToEditId) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const payer = editPayerSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const receiver = editReceiverSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const amount = parseFloat(editTransactionAmountInput.value);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const invoice = invoiceNumberInput.value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const description = editTransactionDescriptionInput.value.trim();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!payer || !receiver || !amount || !invoice) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>alert('Preencha todos os campos obrigatórios.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (payer === receiver) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>alert('A empresa pagadora e a recebedora não podem ser a mesma.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const transactionRef = doc(db, "transactions", transactionToEditId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>await updateDoc(transactionRef, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>payer, receiver, amount, invoice, description</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transactionToEditId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>editModal.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Eventos do botão de Reset</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>resetAllBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>resetModal.style.display = 'flex';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>cancelResetBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>resetModal.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>confirmResetBtn.addEventListener('click', async () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const collectionsToDelete = ['transactions', 'contributions', 'companies'];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Usar um loop para deletar todos os documentos de cada coleção</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>for (const collName of collectionsToDelete) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const querySnapshot = await getDocs(collection(db, collName));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Deletar cada documento encontrado</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>for (const docSnapshot of querySnapshot.docs) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>await deleteDoc(doc(db, collName, docSnapshot.id));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>resetModal.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- Lógica da API Gemini ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const apiKey = ""; // Chave de API é gerenciada pelo ambiente</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>async function callGemini(prompt) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const payload = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>contents: [{ parts: [{ text: prompt }] }],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const response = await fetch(apiUrl, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>headers: { 'Content-Type': 'application/json' },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>body: JSON.stringify(payload)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (!response.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>throw new Error(`API Error: ${response.statusText}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const result = await response.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return result.candidates?.[0]?.content?.parts?.[0]?.text || "Não foi possível obter uma resposta da IA.";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>console.error("Erro ao chamar a API Gemini:", error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return "Erro de comunicação com a IA. Tente novamente mais tarde.";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>generateDescriptionBtn.addEventListener('click', async () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const payer = payerSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const receiver = receiverSelect.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const amount = transactionAmountInput.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const invoice = invoiceNumberInput.value;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if(!payer || !receiver || !amount || !invoice) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>alert('Preencha os campos de Pagador, Recebedor, Valor e NF para gerar uma descrição.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const originalText = generateDescriptionBtn.innerHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>generateDescriptionBtn.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>generateDescriptionBtn.innerHTML = 'Gerando...';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const prompt = `Gere uma descrição curta e formal para uma transação financeira com os seguintes dados: Pagador: ${payer}, Recebedor: ${receiver}, Valor: ${formatCurrency(amount)}, Nota Fiscal: ${invoice}. A descrição deve ter no máximo uma linha.`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const description = await callGemini(prompt);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transactionDescriptionInput.value = description.replace(/(\r\n|\n|\r)/gm, ""); // Remove new lines</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>generateDescriptionBtn.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>generateDescriptionBtn.innerHTML = originalText;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>analyzeFlowBtn.addEventListener('click', async () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const originalText = analyzeFlowBtn.innerHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>analyzeFlowBtn.disabled = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>analyzeFlowBtn.innerHTML = 'Analisando...';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>aiAnalysisContent.innerHTML = '&lt;p class="text-center"&gt;Analisando dados e gerando insights...&lt;/p&gt;';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>aiAnalysisModal.style.display = 'flex';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const balances = calculateBalances();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const dataForPrompt = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>empresas: companies.map(c =&gt; c.name),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>aportes: contributions,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>transacoes: transactions.map(t =&gt; ({ de: t.payer, para: t.receiver, valor: t.amount })),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>saldosFinais: balances</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const prompt = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Aja como um analista financeiro. Analise os seguintes dados de fluxo de caixa em formato JSON e forneça um resumo conciso em português do Brasil, usando tópicos (bullet points com asteriscos).</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>**Dados:**</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>${JSON.stringify(dataForPrompt, null, 2)}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>**Seu resumo deve destacar:**</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>1.<span class="Apple-converted-space">  </span>**Visão Geral:** Um parágrafo curto sobre o estado geral do fluxo de caixa.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>2.<span class="Apple-converted-space">  </span>**Maiores Movimentações:** A empresa que mais realizou pagamentos (total) e a que mais recebeu (total).</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>3.<span class="Apple-converted-space">  </span>**Maior Transação:** Qual foi a maior transação individual (pagador, recebedor e valor).</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>4.<span class="Apple-converted-space">  </span>**Saldos:** A empresa com o maior e o menor saldo final em caixa.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>5.<span class="Apple-converted-space">  </span>**Observações:** Qualquer padrão ou observação interessante que você identificar (ex: uma empresa que só paga e não recebe, ou uma que centraliza os recebimentos).</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Formate sua resposta de forma clara e organizada.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const analysis = await callGemini(prompt);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>aiAnalysisContent.textContent = analysis;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>analyzeFlowBtn.disabled = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>analyzeFlowBtn.innerHTML = originalText;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>closeAiModalBtn.addEventListener('click', () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>aiAnalysisModal.style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
</body>
</html>
